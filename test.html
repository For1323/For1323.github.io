<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Interactive Solar System 3D Model</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: radial-gradient(ellipse at center, #1a1a2e 0%, #16213e 50%, #0f0f23 100%);
            overflow: hidden;
            color: white;
        }

        #container {
            position: relative;
            width: 100vw;
            height: 100vh;
        }

        #controls {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 100;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            min-width: 320px;
            max-height: 90vh;
            overflow-y: auto;
            transition: all 0.4s ease;
        }

        #controls.hidden {
            transform: translateX(-100%);
            opacity: 0;
        }

        #toggleControlsBtn {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 101;
            background: linear-gradient(45deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            opacity: 0;
            transform: scale(0);
        }

        #toggleControlsBtn.visible {
            opacity: 1;
            transform: scale(1);
        }

        #toggleControlsBtn:hover {
            transform: scale(1.1);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.5);
        }

        .control-group {
            margin-bottom: 20px;
        }

        .control-group:last-child {
            margin-bottom: 0;
        }

        .control-label {
            display: block;
            margin-bottom: 10px;
            font-size: 14px;
            color: #a0a0ff;
            font-weight: bold;
        }

        .button-group {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .btn {
            background: linear-gradient(45deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 11px;
            font-weight: bold;
            transition: all 0.3s ease;
            text-transform: uppercase;
            white-space: nowrap;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn.active {
            background: linear-gradient(45deg, #f093fb 0%, #f5576c 100%);
            box-shadow: 0 3px 10px rgba(245, 87, 108, 0.4);
        }

        .btn.danger {
            background: linear-gradient(45deg, #ff6b6b 0%, #ee5a52 100%);
        }

        .btn.success {
            background: linear-gradient(45deg, #51cf66 0%, #40c057 100%);
        }

        .btn.education {
            background: linear-gradient(45deg, #ffd43b 0%, #fab005 100%);
        }

        .speed-control {
            width: 100%;
        }

        .speed-slider {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: linear-gradient(90deg, #667eea, #764ba2);
            outline: none;
            opacity: 0.8;
            transition: opacity 0.2s;
        }

        .speed-slider:hover {
            opacity: 1;
        }

        .speed-value {
            text-align: center;
            margin-top: 8px;
            color: #ffffff;
            font-weight: bold;
            font-size: 12px;
        }

        .time-control {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .checkbox-item input[type="checkbox"] {
            width: 16px;
            height: 16px;
            accent-color: #667eea;
        }

        .checkbox-item label {
            font-size: 12px;
            color: #ffffff;
            cursor: pointer;
        }

        .hide-controls-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.3s ease;
        }

        .hide-controls-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        #planetInfo {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 100;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(15px);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            width: 350px;
            transform: translateX(400px);
            transition: transform 0.4s ease;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        #planetInfo.visible {
            transform: translateX(0);
        }

        .planet-name {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #667eea, #f093fb);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .planet-english {
            font-size: 14px;
            color: #a0a0ff;
            margin-bottom: 20px;
            font-style: italic;
        }

        .planet-data {
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .planet-data:last-child {
            border-bottom: none;
        }

        .data-label {
            color: #a0a0ff;
            font-weight: bold;
            font-size: 14px;
        }

        .data-value {
            color: white;
            font-weight: normal;
            text-align: right;
            font-size: 14px;
        }

        .close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.3s ease;
        }

        .close-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        #title {
            position: absolute;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
            text-align: center;
            color: white;
        }

        .main-title {
            font-size: 28px;
            font-weight: bold;
            background: linear-gradient(45deg, #667eea, #f093fb);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 8px;
        }

        .subtitle {
            font-size: 14px;
            color: #a0a0ff;
            opacity: 0.8;
        }

        .scale-info {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: #a0a0ff;
            font-size: 12px;
            max-width: 280px;
        }

        .fps-display {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
            font-family: 'Orbitron', monospace;
            font-size: 24px;
            font-weight: 700;
            color: #00ff41;
            text-shadow: 0 0 20px #00ff41, 0 0 40px #00ff41;
            background: rgba(0, 0, 0, 0.3);
            padding: 10px 20px;
            border-radius: 20px;
            border: 2px solid rgba(0, 255, 65, 0.3);
            backdrop-filter: blur(10px);
            letter-spacing: 2px;
        }

        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1000;
            text-align: center;
            color: white;
            font-size: 18px;
        }

        .spinner {
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 3px solid #667eea;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .stats-panel {
            position: absolute;
            top: 50%;
            left: 20px;
            transform: translateY(-50%);
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 12px;
            width: 280px;
            display: none;
        }

        .stats-panel.visible {
            display: block;
        }

        .education-panel {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(20px);
            padding: 30px;
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            display: none;
            z-index: 1000;
        }

        .education-panel.visible {
            display: block;
        }

        .education-title {
            font-size: 24px;
            margin-bottom: 20px;
            background: linear-gradient(45deg, #ffd43b, #fab005);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .quiz-container {
            margin-bottom: 30px;
        }

        .question {
            font-size: 18px;
            color: white;
            margin-bottom: 15px;
        }

        .answers {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .answer-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
        }

        .answer-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .answer-btn.correct {
            background: linear-gradient(45deg, #51cf66, #40c057);
        }

        .answer-btn.incorrect {
            background: linear-gradient(45deg, #ff6b6b, #ee5a52);
        }

        .score-display {
            text-align: center;
            font-size: 18px;
            color: #ffd43b;
            margin-bottom: 20px;
        }

        .help-panel {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(20px);
            padding: 30px;
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            display: none;
            z-index: 1000;
        }

        .help-panel.visible {
            display: block;
        }

        .help-title {
            font-size: 20px;
            margin-bottom: 20px;
            background: linear-gradient(45deg, #667eea, #f093fb);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .help-section {
            margin-bottom: 20px;
        }

        .help-section h3 {
            color: #a0a0ff;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .help-section p {
            color: white;
            font-size: 12px;
            line-height: 1.6;
            margin-bottom: 8px;
        }
    </style>
</head>
<body>
    <div id="container">
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>æ­£åœ¨æ„å»ºå¤ªé˜³ç³»...</p>
        </div>

        <button id="toggleControlsBtn" class="visible" onclick="toggleControls()">â˜°</button>

        <div id="controls">
            <button class="hide-controls-btn" onclick="hideControls()">âˆ’</button>
            
            <div class="control-group">
                <label class="control-label">è§†è§’åˆ‡æ¢</label>
                <div class="button-group">
                    <button class="btn active" onclick="setCamera('overview')">å…¨æ™¯</button>
                    <button class="btn" onclick="setCamera('side')">ä¾§è§†</button>
                    <button class="btn" onclick="setCamera('orrery')">å¤ªé˜³ç³»ä»ª</button>
                    <button class="btn" onclick="setCamera('follow')">è·Ÿéšåœ°çƒ</button>
                </div>
            </div>

            <div class="control-group">
                <label class="control-label">å…¬è½¬é€Ÿåº¦</label>
                <div class="speed-control">
                    <input type="range" class="speed-slider" min="0" max="10" step="0.5" value="1" id="speedSlider">
                    <div class="speed-value" id="speedValue">1.0x</div>
                </div>
            </div>

            <div class="control-group">
                <label class="control-label">æ—¶é—´æ–¹å‘</label>
                <div class="time-control">
                    <button class="btn active" onclick="setTimeDirection(1)" id="forwardBtn">æ­£è½¬</button>
                    <button class="btn" onclick="setTimeDirection(-1)" id="reverseBtn">åè½¬</button>
                </div>
            </div>

            <div class="control-group">
                <label class="control-label">æ˜¾ç¤ºæ¨¡å¼</label>
                <div class="button-group">
                    <button class="btn active" onclick="setScaleMode('mixed')" id="scaleMixedBtn">å¹³è¡¡æ¨¡å¼</button>
                    <button class="btn" onclick="setScaleMode('distance')" id="scaleDistanceBtn">è·ç¦»æ¯”ä¾‹</button>
                    <button class="btn" onclick="setScaleMode('size')" id="scaleSizeBtn">å¤§å°æ¯”ä¾‹</button>
                    <button class="btn" onclick="setScaleMode('realistic')" id="scaleRealisticBtn">çœŸå®æ¯”ä¾‹</button>
                </div>
            </div>

            <div class="control-group">
                <label class="control-label">æ˜¾ç¤ºé€‰é¡¹</label>
                <div class="checkbox-group">
                    <div class="checkbox-item">
                        <input type="checkbox" id="showOrbits" checked onchange="toggleOrbits()">
                        <label for="showOrbits">è½¨é“çº¿</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="showAsteroids" checked onchange="toggleAsteroids()">
                        <label for="showAsteroids">å°è¡Œæ˜Ÿå¸¦</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="showComets" checked onchange="toggleComets()">
                        <label for="showComets">å½—æ˜Ÿ</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="showTrails" onchange="toggleTrails()">
                        <label for="showTrails">è½¨è¿¹</label>
                    </div>
                </div>
            </div>

            <div class="control-group">
                <label class="control-label">åŠŸèƒ½</label>
                <div class="button-group">
                    <button class="btn education" onclick="toggleEducation()">å¤©æ–‡é—®ç­”</button>
                    <button class="btn" onclick="toggleStats()">ç»Ÿè®¡é¢æ¿</button>
                    <button class="btn success" onclick="resetCamera()">é‡ç½®è§†è§’</button>
                    <button class="btn" onclick="toggleHelp()">å¸®åŠ©</button>
                    <button class="btn danger" onclick="pauseResume()">æš‚åœ</button>
                </div>
            </div>
        </div>

        <div id="planetInfo">
            <button class="close-btn" onclick="closePlanetInfo()">Ã—</button>
            <div class="planet-name" id="planetName"></div>
            <div class="planet-english" id="planetEnglish"></div>
            <div id="planetData"></div>
        </div>

        <div class="stats-panel" id="statsPanel">
            <h3 style="color: #a0a0ff; margin-bottom: 15px;">å®æ—¶ç»Ÿè®¡</h3>
            <div id="statsContent"></div>
        </div>

        <div class="education-panel" id="educationPanel">
            <button class="close-btn" onclick="toggleEducation()">Ã—</button>
            <h2 class="education-title">ğŸŒŸ å¤©æ–‡çŸ¥è¯†é—®ç­”</h2>
            <div class="score-display" id="scoreDisplay">å¾—åˆ†: <span id="score">0</span> / <span id="totalQuestions">0</span></div>
            <div class="quiz-container" id="quizContainer">
                <!-- é—®é¢˜å°†åŠ¨æ€åŠ è½½ -->
            </div>
            <div class="button-group" style="justify-content: center; margin-top: 20px;">
                <button class="btn education" onclick="nextQuestion()">ä¸‹ä¸€é¢˜</button>
                <button class="btn" onclick="resetQuiz()">é‡æ–°å¼€å§‹</button>
            </div>
        </div>

        <div class="help-panel" id="helpPanel">
            <button class="close-btn" onclick="toggleHelp()">Ã—</button>
            <h2 class="help-title">å¤ªé˜³ç³»3Dæ¨¡å‹ - ä½¿ç”¨æŒ‡å—</h2>
            
            <div class="help-section">
                <h3>ğŸ® åŸºç¡€æ“ä½œ</h3>
                <p>â€¢ é¼ æ ‡æ‹–æ‹½ï¼šæ—‹è½¬è§†è§’</p>
                <p>â€¢ é¼ æ ‡æ»šè½®ï¼šç¼©æ”¾è§†è·</p>
                <p>â€¢ ç‚¹å‡»å¤©ä½“ï¼šæŸ¥çœ‹è¯¦ç»†ä¿¡æ¯</p>
                <p>â€¢ åŒå‡»è¡Œæ˜Ÿï¼šèšç„¦è·Ÿéšæ¨¡å¼</p>
            </div>

            <div class="help-section">
                <h3>ğŸ“ æ˜¾ç¤ºæ¨¡å¼è¯´æ˜</h3>
                <p>â€¢ å¹³è¡¡æ¨¡å¼ï¼šæ•™å­¦å‹å¥½ï¼Œè·ç¦»å’Œå¤§å°éƒ½é€‚ä¸­</p>
                <p>â€¢ è·ç¦»æ¯”ä¾‹ï¼šçœŸå®è·ç¦»æ¯”ä¾‹ï¼Œè¡Œæ˜Ÿå¤§å°æ”¾å¤§</p>
                <p>â€¢ å¤§å°æ¯”ä¾‹ï¼šçœŸå®å¤§å°æ¯”ä¾‹ï¼Œè·ç¦»å‹ç¼©</p>
                <p>â€¢ çœŸå®æ¯”ä¾‹ï¼šå®Œå…¨çœŸå®æ¯”ä¾‹ï¼ˆè¡Œæ˜Ÿæå°ï¼‰</p>
            </div>

            <div class="help-section">
                <h3>â° æ—¶é—´æ§åˆ¶</h3>
                <p>â€¢ æ­£è½¬ï¼šæ­£å¸¸æ—¶é—´æ–¹å‘è¿è¡Œ</p>
                <p>â€¢ åè½¬ï¼šæ—¶é—´å€’æµï¼Œè¡Œæ˜Ÿé€†å‘è¿åŠ¨</p>
                <p>â€¢ é€Ÿåº¦æ»‘å—ï¼šæ§åˆ¶å…¬è½¬é€Ÿåº¦ï¼ˆ0-10å€ï¼‰</p>
            </div>

            <div class="help-section">
                <h3>ğŸ“ æ•™è‚²åŠŸèƒ½</h3>
                <p>â€¢ å¤©æ–‡é—®ç­”ï¼šæµ‹è¯•ä½ çš„å¤©æ–‡çŸ¥è¯†</p>
                <p>â€¢ è¯¦ç»†ä¿¡æ¯ï¼šç‚¹å‡»ä»»æ„å¤©ä½“æŸ¥çœ‹ç§‘å­¦æ•°æ®</p>
                <p>â€¢ çœŸå®æ¯”ä¾‹ï¼šä½“éªŒå®‡å®™çš„çœŸå®å°ºåº¦</p>
            </div>
        </div>

        <div id="title">
            <h1 class="main-title">å¢å¼ºç‰ˆå¤ªé˜³ç³» 3D æ¨¡å‹</h1>
            <p class="subtitle">æ¢ç´¢å®‡å®™å¥¥ç§˜ â€¢ åŒå‡»è¡Œæ˜Ÿè·Ÿéš â€¢ å¤©æ–‡çŸ¥è¯†é—®ç­” â€¢ Fé”®å…¨å±</p>
        </div>

        <div class="scale-info" id="scaleInfo">
            å½“å‰æ¨¡å¼ï¼šå¹³è¡¡æ¨¡å¼<br>
            é€‚åˆæ•™å­¦å’Œè§‚å¯Ÿçš„æœ€ä½³å¹³è¡¡
        </div>

        <div class="fps-display" id="fpsDisplay">60 FPS</div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let scene, camera, renderer, controls;
        let planets = [];
        let orbits = [];
        let asteroids = [];
        let comets = [];
        let sun;
        let speedMultiplier = 1;
        let timeDirection = 1;
        let currentCameraMode = 'overview';
        let scaleMode = 'mixed';
        let animationId;
        let starField;
        let focusedPlanet = null;
        let isPaused = false;
        let showTrails = false;
        let trailPoints = {};
        let lastTime = 0;
        let frameCount = 0;
        let fps = 60;
        let cameraTarget = new THREE.Vector3();
        let cameraPosition = new THREE.Vector3();
        let smoothFactor = 0.05;

        // æ•™è‚²é—®ç­”ç³»ç»Ÿ
        let currentQuestionIndex = 0;
        let score = 0;
        let totalAnswered = 0;
        let answeredQuestions = [];

        const quizQuestions = [
            {
                question: "å“ªä¸ªè¡Œæ˜Ÿæ˜¯å¤ªé˜³ç³»ä¸­æœ€å¤§çš„è¡Œæ˜Ÿï¼Ÿ",
                answers: ["åœ°çƒ", "æœ¨æ˜Ÿ", "åœŸæ˜Ÿ", "æµ·ç‹æ˜Ÿ"],
                correct: 1,
                explanation: "æœ¨æ˜Ÿæ˜¯å¤ªé˜³ç³»ä¸­æœ€å¤§çš„è¡Œæ˜Ÿï¼Œè´¨é‡è¶…è¿‡æ‰€æœ‰å…¶ä»–è¡Œæ˜Ÿçš„æ€»å’Œã€‚"
            },
            {
                question: "å“ªä¸ªè¡Œæ˜Ÿè¢«ç§°ä¸º'çº¢è‰²æ˜Ÿçƒ'ï¼Ÿ",
                answers: ["é‡‘æ˜Ÿ", "ç«æ˜Ÿ", "æœ¨æ˜Ÿ", "åœŸæ˜Ÿ"],
                correct: 1,
                explanation: "ç«æ˜Ÿå› å…¶è¡¨é¢å¯Œå«æ°§åŒ–é“è€Œå‘ˆç°çº¢è‰²ï¼Œå› æ­¤è¢«ç§°ä¸ºçº¢è‰²æ˜Ÿçƒã€‚"
            },
            {
                question: "åœŸæ˜Ÿæœ€è‘—åçš„ç‰¹å¾æ˜¯ä»€ä¹ˆï¼Ÿ",
                answers: ["å·¨å¤§çš„é£æš´", "ç¾ä¸½çš„å…‰ç¯", "æœ€å¤šçš„å«æ˜Ÿ", "æœ€å¿«çš„è‡ªè½¬"],
                correct: 1,
                explanation: "åœŸæ˜Ÿä»¥å…¶ç¾ä¸½å£®è§‚çš„è¡Œæ˜Ÿç¯ç³»ç»Ÿè€Œè‘—åï¼Œè¿™äº›ç¯ç”±å†°å’Œå²©çŸ³é¢—ç²’ç»„æˆã€‚"
            },
            {
                question: "è·ç¦»å¤ªé˜³æœ€è¿‘çš„è¡Œæ˜Ÿæ˜¯å“ªä¸ªï¼Ÿ",
                answers: ["æ°´æ˜Ÿ", "é‡‘æ˜Ÿ", "åœ°çƒ", "ç«æ˜Ÿ"],
                correct: 0,
                explanation: "æ°´æ˜Ÿæ˜¯è·ç¦»å¤ªé˜³æœ€è¿‘çš„è¡Œæ˜Ÿï¼Œå…¬è½¬å‘¨æœŸä»…88å¤©ã€‚"
            },
            {
                question: "å“ªä¸ªè¡Œæ˜Ÿçš„ä¸€å¤©æœ€é•¿ï¼Ÿ",
                answers: ["æ°´æ˜Ÿ", "é‡‘æ˜Ÿ", "åœ°çƒ", "æœ¨æ˜Ÿ"],
                correct: 1,
                explanation: "é‡‘æ˜Ÿçš„è‡ªè½¬å‘¨æœŸä¸º243åœ°çƒæ—¥ï¼Œæ¯”å®ƒçš„å…¬è½¬å‘¨æœŸè¿˜è¦é•¿ã€‚"
            },
            {
                question: "å¤ªé˜³ç³»ä¸­æœ€å†·çš„è¡Œæ˜Ÿæ˜¯å“ªä¸ªï¼Ÿ",
                answers: ["å¤©ç‹æ˜Ÿ", "æµ·ç‹æ˜Ÿ", "å†¥ç‹æ˜Ÿ", "åœŸæ˜Ÿ"],
                correct: 0,
                explanation: "è™½ç„¶æµ·ç‹æ˜Ÿè·ç¦»å¤ªé˜³æ›´è¿œï¼Œä½†å¤©ç‹æ˜Ÿå› å…¶ç‹¬ç‰¹çš„å€¾æ–œè§’åº¦ï¼Œæ˜¯æœ€å†·çš„è¡Œæ˜Ÿã€‚"
            },
            {
                question: "å°è¡Œæ˜Ÿå¸¦ä½äºå“ªä¸¤ä¸ªè¡Œæ˜Ÿä¹‹é—´ï¼Ÿ",
                answers: ["åœ°çƒå’Œç«æ˜Ÿ", "ç«æ˜Ÿå’Œæœ¨æ˜Ÿ", "æœ¨æ˜Ÿå’ŒåœŸæ˜Ÿ", "åœŸæ˜Ÿå’Œå¤©ç‹æ˜Ÿ"],
                correct: 1,
                explanation: "å°è¡Œæ˜Ÿå¸¦ä½äºç«æ˜Ÿå’Œæœ¨æ˜Ÿä¹‹é—´ï¼ŒåŒ…å«æ•°åä¸‡é¢—å°è¡Œæ˜Ÿã€‚"
            },
            {
                question: "å“ˆé›·å½—æ˜Ÿå¤šå°‘å¹´å›å½’ä¸€æ¬¡ï¼Ÿ",
                answers: ["50å¹´", "76å¹´", "100å¹´", "120å¹´"],
                correct: 1,
                explanation: "å“ˆé›·å½—æ˜Ÿçš„å…¬è½¬å‘¨æœŸçº¦ä¸º76å¹´ï¼Œä¸Šæ¬¡å›å½’æ˜¯1986å¹´ã€‚"
            }
        ];
        
        // å¢å¼ºçš„è¡Œæ˜Ÿæ•°æ®ï¼ŒåŒ…å«çº¹ç†ä¿¡æ¯
        const planetData = {
            mercury: {
                name: 'æ°´æ˜Ÿ', english: 'Mercury',
                realRadius: 0.38, realDistance: 10, speed: 0.024, 
                color: 0x8c7853, craterIntensity: 0.8,
                diameter: '4,879 km', avgDistance: '5,790ä¸‡ km', 
                orbitalPeriod: '88å¤©', rotationPeriod: '59å¤©', type: 'å²©çŸ³è¡Œæ˜Ÿ',
                mass: '3.3 Ã— 10Â²Â³ kg', gravity: '3.7 m/sÂ²', temperature: '-173~427Â°C',
                description: 'å¤ªé˜³ç³»æœ€å°çš„è¡Œæ˜Ÿï¼Œè¡¨é¢å¸ƒæ»¡é™¨çŸ³å‘ï¼Œæ¸©å·®æå¤§ã€‚'
            },
            venus: {
                name: 'é‡‘æ˜Ÿ', english: 'Venus',
                realRadius: 0.95, realDistance: 15, speed: 0.018, 
                color: 0xffc649, cloudIntensity: 0.9,
                diameter: '12,104 km', avgDistance: '1.08äº¿ km',
                orbitalPeriod: '225å¤©', rotationPeriod: '243å¤©', type: 'å²©çŸ³è¡Œæ˜Ÿ',
                mass: '4.87 Ã— 10Â²â´ kg', gravity: '8.87 m/sÂ²', temperature: '462Â°C',
                description: 'è¢«åšåšçš„äº‘å±‚è¦†ç›–ï¼Œæ˜¯å¤ªé˜³ç³»ä¸­æœ€çƒ­çš„è¡Œæ˜Ÿã€‚'
            },
            earth: {
                name: 'åœ°çƒ', english: 'Earth',
                realRadius: 1, realDistance: 20, speed: 0.015, 
                color: 0x6b93d6, oceanIntensity: 0.7, landIntensity: 0.3,
                diameter: '12,756 km', avgDistance: '1.5äº¿ km',
                orbitalPeriod: '365å¤©', rotationPeriod: '24å°æ—¶', type: 'å²©çŸ³è¡Œæ˜Ÿ',
                mass: '5.97 Ã— 10Â²â´ kg', gravity: '9.8 m/sÂ²', temperature: '-89~58Â°C',
                description: 'å¤ªé˜³ç³»ä¸­å”¯ä¸€å·²çŸ¥å­˜åœ¨ç”Ÿå‘½çš„è¡Œæ˜Ÿï¼Œè¢«ç§°ä¸ºè“è‰²æ˜Ÿçƒã€‚'
            },
            mars: {
                name: 'ç«æ˜Ÿ', english: 'Mars',
                realRadius: 0.53, realDistance: 25, speed: 0.012, 
                color: 0xc1440e, craterIntensity: 0.6, dustIntensity: 0.8,
                diameter: '6,792 km', avgDistance: '2.28äº¿ km',
                orbitalPeriod: '687å¤©', rotationPeriod: '24.6å°æ—¶', type: 'å²©çŸ³è¡Œæ˜Ÿ',
                mass: '6.42 Ã— 10Â²Â³ kg', gravity: '3.71 m/sÂ²', temperature: '-87~-5Â°C',
                description: 'çº¢è‰²æ˜Ÿçƒï¼Œè¡¨é¢æœ‰å·¨å¤§çš„å³¡è°·å’Œç«å±±ï¼Œå¯èƒ½æ›¾ç»æœ‰æ°´ã€‚'
            },
            jupiter: {
                name: 'æœ¨æ˜Ÿ', english: 'Jupiter',
                realRadius: 3, realDistance: 40, speed: 0.006, 
                color: 0xd8ca9d, bandIntensity: 0.9, stormIntensity: 0.7,
                diameter: '142,984 km', avgDistance: '7.79äº¿ km',
                orbitalPeriod: '12å¹´', rotationPeriod: '9.9å°æ—¶', type: 'æ°”æ€å·¨æ˜Ÿ',
                mass: '1.90 Ã— 10Â²â· kg', gravity: '24.79 m/sÂ²', temperature: '-108Â°C',
                description: 'å¤ªé˜³ç³»æœ€å¤§çš„è¡Œæ˜Ÿï¼Œæ‹¥æœ‰è‘—åçš„å¤§çº¢æ–‘é£æš´å’Œä¼—å¤šå«æ˜Ÿã€‚'
            },
            saturn: {
                name: 'åœŸæ˜Ÿ', english: 'Saturn',
                realRadius: 2.5, realDistance: 55, speed: 0.004, 
                color: 0xfad5a5, ringIntensity: 1.0,
                diameter: '120,536 km', avgDistance: '14.3äº¿ km',
                orbitalPeriod: '29å¹´', rotationPeriod: '10.7å°æ—¶', type: 'æ°”æ€å·¨æ˜Ÿ',
                mass: '5.68 Ã— 10Â²â¶ kg', gravity: '10.44 m/sÂ²', temperature: '-139Â°C',
                description: 'æ‹¥æœ‰å£®è§‚å…‰ç¯ç³»ç»Ÿçš„ç¾ä¸½è¡Œæ˜Ÿï¼Œå¯†åº¦æ¯”æ°´è¿˜å°ã€‚'
            },
            uranus: {
                name: 'å¤©ç‹æ˜Ÿ', english: 'Uranus',
                realRadius: 1.5, realDistance: 70, speed: 0.003, 
                color: 0x4fd0e7, iceIntensity: 0.8,
                diameter: '51,118 km', avgDistance: '28.7äº¿ km',
                orbitalPeriod: '84å¹´', rotationPeriod: '17.2å°æ—¶', type: 'å†°å·¨æ˜Ÿ',
                mass: '8.68 Ã— 10Â²âµ kg', gravity: '8.69 m/sÂ²', temperature: '-197Â°C',
                description: 'ä¾§èººç€å…¬è½¬çš„å†°å·¨æ˜Ÿï¼Œæ‹¥æœ‰å¾®å¼±çš„å…‰ç¯ç³»ç»Ÿã€‚'
            },
            neptune: {
                name: 'æµ·ç‹æ˜Ÿ', english: 'Neptune',
                realRadius: 1.4, realDistance: 85, speed: 0.002, 
                color: 0x4b70dd, windIntensity: 0.9,
                diameter: '49,528 km', avgDistance: '45.0äº¿ km',
                orbitalPeriod: '165å¹´', rotationPeriod: '16.1å°æ—¶', type: 'å†°å·¨æ˜Ÿ',
                mass: '1.02 Ã— 10Â²â¶ kg', gravity: '11.15 m/sÂ²', temperature: '-201Â°C',
                description: 'å¤ªé˜³ç³»æœ€è¿œçš„è¡Œæ˜Ÿï¼Œæ‹¥æœ‰æœ€å¼ºçƒˆçš„é£æš´ï¼Œé£é€Ÿå¯è¾¾2100å…¬é‡Œ/å°æ—¶ã€‚'
            }
        };

        // å½—æ˜Ÿæ•°æ®
        const cometData = [
            {
                name: 'å“ˆé›·å½—æ˜Ÿ', english: 'Halley\'s Comet',
                perihelion: 15, aphelion: 80, speed: 0.008, color: 0x88ccff,
                orbitalPeriod: '76å¹´', type: 'å‘¨æœŸå½—æ˜Ÿ'
            },
            {
                name: 'æ©å…‹å½—æ˜Ÿ', english: 'Encke\'s Comet',
                perihelion: 8, aphelion: 35, speed: 0.015, color: 0xaaffcc,
                orbitalPeriod: '3.3å¹´', type: 'çŸ­å‘¨æœŸå½—æ˜Ÿ'
            }
        ];

        // åˆå§‹åŒ–åœºæ™¯
        function init() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 5000);
            camera.position.set(0, 80, 120);

            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            document.getElementById('container').appendChild(renderer.domElement);

            createStarField();
            createSun();
            createPlanets();
            createAsteroidBelt();
            createComets();
            setupLighting();
            setupControls();
            setupEventListeners();
            initTrailTracking();
            initEducationSystem();

            document.getElementById('loading').style.display = 'none';
            animate();
        }

        // åˆ›å»ºå¢å¼ºçš„æ˜Ÿç©ºèƒŒæ™¯
        function createStarField() {
            const geometry = new THREE.SphereGeometry(1500, 64, 64);
            const material = new THREE.MeshBasicMaterial({
                color: 0x000022,
                side: THREE.BackSide
            });
            starField = new THREE.Mesh(geometry, material);
            
            // åˆ›å»ºå¤šå±‚æ˜Ÿç‚¹æ•ˆæœ
            for (let layer = 0; layer < 3; layer++) {
                const starGeometry = new THREE.BufferGeometry();
                const starCount = 5000 + layer * 2000;
                const starVertices = [];
                const starColors = [];
                
                for (let i = 0; i < starCount; i++) {
                    const theta = Math.random() * Math.PI * 2;
                    const phi = Math.acos(Math.random() * 2 - 1);
                    const r = 1200 + Math.random() * 300 + layer * 100;
                    
                    starVertices.push(
                        r * Math.sin(phi) * Math.cos(theta),
                        r * Math.sin(phi) * Math.sin(theta),
                        r * Math.cos(phi)
                    );
                    
                    // ä¸åŒé¢œè‰²çš„æ˜Ÿæ˜Ÿ
                    const starType = Math.random();
                    if (starType < 0.7) {
                        starColors.push(1, 1, 1); // ç™½è‰²
                    } else if (starType < 0.9) {
                        starColors.push(1, 0.8, 0.6); // é»„è‰²
                    } else {
                        starColors.push(0.8, 0.8, 1); // è“è‰²
                    }
                }

                starGeometry.setAttribute('position', new THREE.Float32BufferAttribute(starVertices, 3));
                starGeometry.setAttribute('color', new THREE.Float32BufferAttribute(starColors, 3));
                
                const starMaterial = new THREE.PointsMaterial({
                    vertexColors: true,
                    size: 1 + layer * 0.5,
                    sizeAttenuation: false
                });

                const stars = new THREE.Points(starGeometry, starMaterial);
                scene.add(stars);
            }
            
            scene.add(starField);
        }

        // åˆ›å»ºå¢å¼ºçš„å¤ªé˜³
        function createSun() {
            const sunGeometry = new THREE.SphereGeometry(5, 64, 64);
            
            // åˆ›å»ºå¤ªé˜³è¡¨é¢çº¹ç†æ•ˆæœ
            const sunMaterial = new THREE.MeshBasicMaterial({
                color: 0xffff00,
                emissive: 0xff6600,
                emissiveIntensity: 0.6
            });
            
            sun = new THREE.Mesh(sunGeometry, sunMaterial);
            sun.castShadow = false;
            sun.userData = { 
                name: 'å¤ªé˜³', 
                english: 'Sun',
                diameter: '1,392,700 km',
                avgDistance: '0 km',
                orbitalPeriod: 'ä¸é€‚ç”¨',
                rotationPeriod: '25å¤©',
                type: 'æ’æ˜Ÿ',
                mass: '1.99 Ã— 10Â³â° kg',
                temperature: '5,778K (è¡¨é¢)',
                description: 'å¤ªé˜³ç³»çš„ä¸­å¿ƒæ’æ˜Ÿï¼Œä¸ºæ‰€æœ‰è¡Œæ˜Ÿæä¾›å…‰å’Œçƒ­ã€‚'
            };
            
            // æ·»åŠ å¤ªé˜³å…‰æ™•æ•ˆæœ
            const coronaGeometry = new THREE.SphereGeometry(7, 32, 32);
            const coronaMaterial = new THREE.MeshBasicMaterial({
                color: 0xff8800,
                transparent: true,
                opacity: 0.1,
                side: THREE.BackSide
            });
            const corona = new THREE.Mesh(coronaGeometry, coronaMaterial);
            sun.add(corona);
            
            scene.add(sun);
        }

        // åˆ›å»ºå¢å¼ºçš„è¡Œæ˜Ÿç³»ç»Ÿ
        function createPlanets() {
            const planetKeys = Object.keys(planetData);
            
            planetKeys.forEach((key, index) => {
                const data = planetData[key];
                
                // åˆ›å»ºç²¾ç¡®çš„è½¨é“
                const orbitGeometry = new THREE.RingGeometry(data.realDistance - 0.1, data.realDistance + 0.1, 256);
                const orbitMaterial = new THREE.MeshBasicMaterial({
                    color: 0x444444,
                    side: THREE.DoubleSide,
                    transparent: true,
                    opacity: 0.2
                });
                const orbit = new THREE.Mesh(orbitGeometry, orbitMaterial);
                orbit.rotation.x = -Math.PI / 2;
                orbit.userData = { type: 'orbit', planetKey: key };
                scene.add(orbit);
                orbits.push(orbit);

                // åˆ›å»ºå¢å¼ºçš„è¡Œæ˜Ÿ
                const planet = createDetailedPlanet(data, key);
                scene.add(planet);
                planets.push(planet);
            });
        }

        // åˆ›å»ºè¯¦ç»†çš„è¡Œæ˜Ÿ
        function createDetailedPlanet(data, key) {
            const planetGeometry = new THREE.SphereGeometry(data.realRadius, 64, 64);
            
            // æ ¹æ®è¡Œæ˜Ÿç‰¹ç‚¹åˆ›å»ºä¸åŒçš„æè´¨
            let planetMaterial;
            
            if (key === 'earth') {
                // åœ°çƒï¼šæµ·æ´‹å’Œé™†åœ°
                planetMaterial = new THREE.MeshLambertMaterial({ 
                    color: data.color,
                    transparent: true,
                    opacity: 0.9
                });
                
                // æ·»åŠ å¤§æ°”å±‚æ•ˆæœ
                const atmosphereGeometry = new THREE.SphereGeometry(data.realRadius * 1.05, 32, 32);
                const atmosphereMaterial = new THREE.MeshBasicMaterial({
                    color: 0x87ceeb,
                    transparent: true,
                    opacity: 0.1,
                    side: THREE.BackSide
                });
                const atmosphere = new THREE.Mesh(atmosphereGeometry, atmosphereMaterial);
                
            } else if (key === 'jupiter' || key === 'saturn') {
                // æ°”æ€å·¨æ˜Ÿï¼šå¸¦çŠ¶ç»“æ„
                planetMaterial = new THREE.MeshLambertMaterial({ 
                    color: data.color
                });
                
            } else if (key === 'mars') {
                // ç«æ˜Ÿï¼šè¡¨é¢ç»†èŠ‚
                planetMaterial = new THREE.MeshLambertMaterial({ 
                    color: data.color,
                    roughness: 0.9
                });
                
            } else {
                // å…¶ä»–è¡Œæ˜Ÿ
                planetMaterial = new THREE.MeshLambertMaterial({ 
                    color: data.color,
                    roughness: 0.7
                });
            }
            
            const planet = new THREE.Mesh(planetGeometry, planetMaterial);
            
            // ç²¾ç¡®å®šä½åœ¨è½¨é“ä¸Š
            planet.position.x = data.realDistance;
            planet.position.y = 0;
            planet.position.z = 0;
            
            planet.castShadow = true;
            planet.receiveShadow = true;
            
            planet.userData = {
                ...data,
                key: key,
                angle: Math.random() * Math.PI * 2,
                originalRadius: data.realRadius,
                originalDistance: data.realDistance,
                basePosition: new THREE.Vector3(data.realDistance, 0, 0)
            };
            
            // ç‰¹æ®Šå¤„ç†
            if (key === 'saturn') {
                addSaturnRings(planet, data);
            } else if (key === 'earth') {
                // å¦‚æœæœ‰å¤§æ°”å±‚ï¼Œæ·»åŠ åˆ°åœºæ™¯
                if (typeof atmosphere !== 'undefined') {
                    planet.add(atmosphere);
                }
            }
            
            return planet;
        }

        // æ·»åŠ åœŸæ˜Ÿå…‰ç¯
        function addSaturnRings(planet, data) {
            const ringGeometry = new THREE.RingGeometry(data.realRadius * 1.2, data.realRadius * 2.2, 128);
            const ringMaterial = new THREE.MeshBasicMaterial({
                color: 0xccccaa,
                side: THREE.DoubleSide,
                transparent: true,
                opacity: 0.8
            });
            const ring = new THREE.Mesh(ringGeometry, ringMaterial);
            ring.rotation.x = -Math.PI / 2;
            ring.rotation.z = Math.PI / 12; // å€¾æ–œ
            planet.add(ring);
        }

        // æ·»åŠ åœ°çƒæœˆçƒ
        function addEarthMoon(planet) {
            const moonGeometry = new THREE.SphereGeometry(0.27, 32, 32);
            const moonMaterial = new THREE.MeshLambertMaterial({ 
                color: 0x888888,
                roughness: 1.0
            });
            const moon = new THREE.Mesh(moonGeometry, moonMaterial);
            moon.position.set(3.84, 0, 0); // çœŸå®æ¯”ä¾‹è·ç¦»
            moon.castShadow = true;
            moon.receiveShadow = true;
            moon.userData = {
                name: 'æœˆçƒ', english: 'Moon', type: 'å¤©ç„¶å«æ˜Ÿ',
                angle: 0, speed: 0.05,
                diameter: '3,474 km',
                avgDistance: '384,400 km',
                orbitalPeriod: '27.3å¤©',
                description: 'åœ°çƒå”¯ä¸€çš„å¤©ç„¶å«æ˜Ÿï¼Œå½±å“åœ°çƒçš„æ½®æ±ã€‚'
            };
            planet.add(moon);
        }

        // åˆ›å»ºå°è¡Œæ˜Ÿå¸¦
        function createAsteroidBelt() {
            const asteroidCount = 1000;
            const minDistance = 30;
            const maxDistance = 38;

            for (let i = 0; i < asteroidCount; i++) {
                const distance = minDistance + Math.random() * (maxDistance - minDistance);
                const initialAngle = Math.random() * Math.PI * 2;
                const size = 0.02 + Math.random() * 0.1;

                // éšæœºå½¢çŠ¶çš„å°è¡Œæ˜Ÿ
                const asteroidGeometry = new THREE.SphereGeometry(size, 6, 6);
                
                // éšæœºå˜å½¢
                const positions = asteroidGeometry.attributes.position.array;
                for (let j = 0; j < positions.length; j += 3) {
                    positions[j] *= 0.7 + Math.random() * 0.6;
                    positions[j + 1] *= 0.7 + Math.random() * 0.6;
                    positions[j + 2] *= 0.7 + Math.random() * 0.6;
                }
                asteroidGeometry.attributes.position.needsUpdate = true;
                asteroidGeometry.computeVertexNormals();
                
                const asteroidMaterial = new THREE.MeshLambertMaterial({ 
                    color: new THREE.Color().setHSL(0.1, 0.2, 0.1 + Math.random() * 0.3)
                });
                
                const asteroid = new THREE.Mesh(asteroidGeometry, asteroidMaterial);
                const asteroidPosX = Math.cos(initialAngle) * distance;
                const asteroidPosZ = Math.sin(initialAngle) * distance;
                const asteroidPosY = (Math.random() - 0.5) * 1;
                asteroid.position.set(asteroidPosX, asteroidPosY, asteroidPosZ);
                
                asteroid.castShadow = true;
                
                asteroid.userData = {
                    type: 'asteroid',
                    distance: distance,
                    angle: initialAngle,
                    speed: 0.0005 + Math.random() * 0.001,
                    rotationSpeed: (Math.random() - 0.5) * 0.02,
                    name: `å°è¡Œæ˜Ÿ ${i + 1}`,
                    description: 'å°è¡Œæ˜Ÿå¸¦ä¸­çš„å²©çŸ³ç¢ç‰‡ï¼Œå¯èƒ½æ˜¯è¡Œæ˜Ÿå½¢æˆæ—¶çš„æ®‹ç•™ç‰©ã€‚'
                };
                
                scene.add(asteroid);
                asteroids.push(asteroid);
            }
        }

        // åˆ›å»ºå½—æ˜Ÿ
        function createComets() {
            cometData.forEach((data, index) => {
                const cometGeometry = new THREE.SphereGeometry(0.2, 16, 16);
                const cometMaterial = new THREE.MeshLambertMaterial({ 
                    color: data.color,
                    emissive: data.color,
                    emissiveIntensity: 0.3
                });
                
                const comet = new THREE.Mesh(cometGeometry, cometMaterial);
                comet.position.x = data.perihelion;
                comet.castShadow = true;
                
                // åˆ›å»ºå½—å°¾
                const tailGeometry = new THREE.ConeGeometry(0.3, 6, 12);
                const tailMaterial = new THREE.MeshBasicMaterial({
                    color: data.color,
                    transparent: true,
                    opacity: 0.4
                });
                const tail = new THREE.Mesh(tailGeometry, tailMaterial);
                tail.rotation.z = Math.PI / 2;
                tail.position.x = -3;
                comet.add(tail);

                comet.userData = {
                    ...data,
                    type: 'comet',
                    angle: Math.random() * Math.PI * 2,
                    currentDistance: data.perihelion
                };
                
                scene.add(comet);
                comets.push(comet);
            });
        }

        // è®¾ç½®å…‰ç…§
        function setupLighting() {
            const ambientLight = new THREE.AmbientLight(0x404040, 0.2);
            scene.add(ambientLight);

            const sunLight = new THREE.PointLight(0xffffff, 2, 2000);
            sunLight.position.set(0, 0, 0);
            sunLight.castShadow = true;
            sunLight.shadow.mapSize.width = 4096;
            sunLight.shadow.mapSize.height = 4096;
            sunLight.shadow.camera.far = 2000;
            scene.add(sunLight);
        }

        // åˆå§‹åŒ–è½¨è¿¹è¿½è¸ª
        function initTrailTracking() {
            planets.forEach(planet => {
                trailPoints[planet.userData.key] = [];
            });
        }

        // åˆå§‹åŒ–æ•™è‚²ç³»ç»Ÿ
        function initEducationSystem() {
            shuffleArray(quizQuestions);
            loadQuestion();
        }

        // æ‰“ä¹±æ•°ç»„
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        // åŠ è½½é—®é¢˜
        function loadQuestion() {
            if (currentQuestionIndex >= quizQuestions.length) {
                currentQuestionIndex = 0;
                shuffleArray(quizQuestions);
            }
            
            const question = quizQuestions[currentQuestionIndex];
            if (answeredQuestions.includes(currentQuestionIndex)) {
                currentQuestionIndex++;
                loadQuestion();
                return;
            }
            
            const container = document.getElementById('quizContainer');
            container.innerHTML = `
                <div class="question">Q${totalAnswered + 1}: ${question.question}</div>
                <div class="answers">
                    ${question.answers.map((answer, index) => 
                        `<button class="answer-btn" onclick="selectAnswer(${index})">${String.fromCharCode(65 + index)}. ${answer}</button>`
                    ).join('')}
                </div>
                <div id="explanation" style="margin-top: 15px; padding: 10px; background: rgba(255,255,255,0.1); border-radius: 8px; display: none;">
                    <strong>è§£é‡Šï¼š</strong><span id="explanationText"></span>
                </div>
            `;
        }

        // é€‰æ‹©ç­”æ¡ˆ
        function selectAnswer(selectedIndex) {
            const question = quizQuestions[currentQuestionIndex];
            const buttons = document.querySelectorAll('.answer-btn');
            const explanation = document.getElementById('explanation');
            const explanationText = document.getElementById('explanationText');
            
            buttons.forEach((btn, index) => {
                btn.disabled = true;
                if (index === question.correct) {
                    btn.classList.add('correct');
                } else if (index === selectedIndex && selectedIndex !== question.correct) {
                    btn.classList.add('incorrect');
                }
            });
            
            if (selectedIndex === question.correct) {
                score++;
            }
            
            totalAnswered++;
            answeredQuestions.push(currentQuestionIndex);
            
            explanationText.textContent = question.explanation;
            explanation.style.display = 'block';
            
            updateScore();
        }

        // æ›´æ–°åˆ†æ•°æ˜¾ç¤º
        function updateScore() {
            document.getElementById('score').textContent = score;
            document.getElementById('totalQuestions').textContent = totalAnswered;
        }

        // ä¸‹ä¸€é¢˜
        function nextQuestion() {
            currentQuestionIndex++;
            loadQuestion();
        }

        // é‡ç½®é—®ç­”
        function resetQuiz() {
            currentQuestionIndex = 0;
            score = 0;
            totalAnswered = 0;
            answeredQuestions = [];
            shuffleArray(quizQuestions);
            updateScore();
            loadQuestion();
        }

        // æ§åˆ¶é¢æ¿åˆ‡æ¢
        function toggleControls() {
            const controls = document.getElementById('controls');
            const toggleBtn = document.getElementById('toggleControlsBtn');
            
            controls.classList.remove('hidden');
            toggleBtn.classList.remove('visible');
        }

        function hideControls() {
            const controls = document.getElementById('controls');
            const toggleBtn = document.getElementById('toggleControlsBtn');
            
            controls.classList.add('hidden');
            setTimeout(() => {
                toggleBtn.classList.add('visible');
            }, 200);
        }

        // ä¼˜åŒ–çš„ç›¸æœºè·Ÿè¸ªç³»ç»Ÿ
        function updateFollowCamera() {
            if (currentCameraMode === 'follow' && focusedPlanet) {
                const targetPosition = focusedPlanet.position.clone();
                const offset = new THREE.Vector3(
                    focusedPlanet.userData.radius * 8,
                    focusedPlanet.userData.radius * 4,
                    focusedPlanet.userData.radius * 8
                );
                
                targetPosition.add(offset);
                
                // å¹³æ»‘ç›¸æœºç§»åŠ¨
                camera.position.lerp(targetPosition, smoothFactor);
                
                // å¹³æ»‘ç›¸æœºæœå‘
                cameraTarget.copy(focusedPlanet.position);
                camera.lookAt(cameraTarget);
            }
        }

        // è®¾ç½®æ§åˆ¶å™¨
        function setupControls() {
            let mouseDown = false;
            let mouseX = 0;
            let mouseY = 0;

            renderer.domElement.addEventListener('mousedown', (event) => {
                mouseDown = true;
                mouseX = event.clientX;
                mouseY = event.clientY;
            });

            renderer.domElement.addEventListener('mouseup', () => {
                mouseDown = false;
            });

            renderer.domElement.addEventListener('mousemove', (event) => {
                if (!mouseDown) return;

                const deltaX = event.clientX - mouseX;
                const deltaY = event.clientY - mouseY;

                if (currentCameraMode !== 'follow') {
                    const spherical = new THREE.Spherical();
                    spherical.setFromVector3(camera.position);
                    
                    spherical.theta -= deltaX * 0.008;
                    spherical.phi += deltaY * 0.008;
                    spherical.phi = Math.max(0.1, Math.min(Math.PI - 0.1, spherical.phi));

                    camera.position.setFromSpherical(spherical);
                    camera.lookAt(0, 0, 0);
                }

                mouseX = event.clientX;
                mouseY = event.clientY;
            });

            renderer.domElement.addEventListener('wheel', (event) => {
                if (currentCameraMode !== 'follow') {
                    const distance = camera.position.length();
                    const newDistance = distance + event.deltaY * 0.3;
                    
                    if (newDistance > 15 && newDistance < 1000) {
                        camera.position.normalize();
                        camera.position.multiplyScalar(newDistance);
                    }
                }
            });

            renderer.domElement.addEventListener('dblclick', onPlanetDoubleClick);
        }

        // è®¾ç½®äº‹ä»¶ç›‘å¬
        function setupEventListeners() {
            const speedSlider = document.getElementById('speedSlider');
            speedSlider.addEventListener('input', (e) => {
                speedMultiplier = parseFloat(e.target.value);
                document.getElementById('speedValue').textContent = speedMultiplier.toFixed(1) + 'x';
            });

            window.addEventListener('resize', () => {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            });

            renderer.domElement.addEventListener('click', onPlanetClick);
            window.addEventListener('keydown', onKeyDown);
        }

        // é”®ç›˜äº‹ä»¶å¤„ç†
        function onKeyDown(event) {
            switch(event.code) {
                case 'Space':
                    event.preventDefault();
                    pauseResume();
                    break;
                case 'KeyF':
                    toggleFullscreen();
                    break;
                case 'KeyR':
                    resetCamera();
                    break;
                case 'KeyH':
                    toggleHelp();
                    break;
                case 'KeyS':
                    toggleStats();
                    break;
                case 'KeyE':
                    toggleEducation();
                    break;
            }
        }

        // è¡Œæ˜Ÿç‚¹å‡»äº‹ä»¶
        function onPlanetClick(event) {
            const mouse = new THREE.Vector2();
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

            const raycaster = new THREE.Raycaster();
            raycaster.setFromCamera(mouse, camera);

            const allObjects = [sun, ...planets, ...asteroids.slice(0, 50), ...comets];
            const intersects = raycaster.intersectObjects(allObjects, true);
            
            if (intersects.length > 0) {
                let clickedObject = intersects[0].object;
                
                // å¦‚æœç‚¹å‡»çš„æ˜¯å­å¯¹è±¡ï¼ˆå¦‚æœˆçƒï¼‰ï¼Œè·å–å…¶æ•°æ®
                if (clickedObject.parent && clickedObject.parent.userData && clickedObject.parent.userData.key) {
                    showPlanetInfo(clickedObject.userData);
                } else {
                    showPlanetInfo(clickedObject.userData);
                }
            }
        }

        // åŒå‡»èšç„¦äº‹ä»¶
        function onPlanetDoubleClick(event) {
            const mouse = new THREE.Vector2();
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

            const raycaster = new THREE.Raycaster();
            raycaster.setFromCamera(mouse, camera);

            const intersects = raycaster.intersectObjects(planets);
            
            if (intersects.length > 0) {
                focusedPlanet = intersects[0].object;
                setCamera('follow');
            }
        }

        // ä¿®æ­£è¡Œæ˜Ÿä½ç½®ï¼Œç¡®ä¿åœ¨è½¨é“ä¸Š
        function updatePlanetPositions() {
            planets.forEach(planet => {
                const data = planet.userData;
                
                // ç²¾ç¡®çš„è½¨é“è¿åŠ¨
                data.angle += data.speed * speedMultiplier * timeDirection;
                
                // ç¡®ä¿è¡Œæ˜Ÿä¸¥æ ¼æŒ‰ç…§è½¨é“è¿åŠ¨
                const x = Math.cos(data.angle) * data.distance;
                const z = Math.sin(data.angle) * data.distance;
                
                planet.position.set(x, 0, z);
                
                // è‡ªè½¬
                planet.rotation.y += 0.008 * speedMultiplier * timeDirection;
                
                // å¤„ç†æœˆçƒ
                if (data.key === 'earth') {
                    const moon = planet.children.find(child => child.userData && child.userData.name === 'æœˆçƒ');
                    if (moon) {
                        moon.userData.angle += moon.userData.speed * speedMultiplier * timeDirection;
                        const moonX = Math.cos(moon.userData.angle) * 3.84;
                        moon.userData.angle += moon.userData.speed * speedMultiplier * timeDirection;
                        const moonX = Math.cos(moon.userData.angle) * 3.84;
                        const moonZ = Math.sin(moon.userData.angle) * 3.84;
                        moon.position.set(moonX, 0, moonZ);
                        moon.rotation.y += 0.05 * speedMultiplier * timeDirection;
                    }
                }
            });
        }

        // æ˜¾ç¤ºå¤©ä½“ä¿¡æ¯
        function showPlanetInfo(data) {
            if (!data || !data.name) return;

            document.getElementById('planetName').textContent = data.name;
            document.getElementById('planetEnglish').textContent = data.english || '';
            
            const planetDataDiv = document.getElementById('planetData');
            let htmlContent = `
                <div class="planet-data">
                    <span class="data-label">ç±»å‹:</span>
                    <span class="data-value">${data.type || 'æœªçŸ¥'}</span>
                </div>
            `;

            if (data.description) {
                htmlContent += `
                    <div class="planet-data">
                        <span class="data-label">æè¿°:</span>
                        <span class="data-value" style="font-size: 12px; line-height: 1.4;">${data.description}</span>
                    </div>
                `;
            }

            if (data.diameter) {
                htmlContent += `
                    <div class="planet-data">
                        <span class="data-label">ç›´å¾„:</span>
                        <span class="data-value">${data.diameter}</span>
                    </div>
                `;
            }

            if (data.avgDistance) {
                htmlContent += `
                    <div class="planet-data">
                        <span class="data-label">è·å¤ªé˜³:</span>
                        <span class="data-value">${data.avgDistance}</span>
                    </div>
                `;
            }

            if (data.orbitalPeriod) {
                htmlContent += `
                    <div class="planet-data">
                        <span class="data-label">å…¬è½¬å‘¨æœŸ:</span>
                        <span class="data-value">${data.orbitalPeriod}</span>
                    </div>
                `;
            }

            if (data.rotationPeriod) {
                htmlContent += `
                    <div class="planet-data">
                        <span class="data-label">è‡ªè½¬å‘¨æœŸ:</span>
                        <span class="data-value">${data.rotationPeriod}</span>
                    </div>
                `;
            }

            if (data.mass) {
                htmlContent += `
                    <div class="planet-data">
                        <span class="data-label">è´¨é‡:</span>
                        <span class="data-value">${data.mass}</span>
                    </div>
                `;
            }

            if (data.gravity) {
                htmlContent += `
                    <div class="planet-data">
                        <span class="data-label">è¡¨é¢é‡åŠ›:</span>
                        <span class="data-value">${data.gravity}</span>
                    </div>
                `;
            }

            if (data.temperature) {
                htmlContent += `
                    <div class="planet-data">
                        <span class="data-label">æ¸©åº¦:</span>
                        <span class="data-value">${data.temperature}</span>
                    </div>
                `;
            }
            
            planetDataDiv.innerHTML = htmlContent;
            document.getElementById('planetInfo').classList.add('visible');
        }

        // å…³é—­è¡Œæ˜Ÿä¿¡æ¯
        function closePlanetInfo() {
            document.getElementById('planetInfo').classList.remove('visible');
        }

        // è®¾ç½®ç›¸æœºè§†è§’
        function setCamera(mode) {
            // ç§»é™¤æ‰€æœ‰ç›¸å…³æŒ‰é’®çš„activeç±»
            document.querySelectorAll('#controls .btn').forEach(btn => {
                const text = btn.textContent;
                if (text.includes('å…¨æ™¯') || text.includes('ä¾§è§†') || text.includes('ç³»ä»ª') || text.includes('è·Ÿéš')) {
                    btn.classList.remove('active');
                }
            });
            
            // æ·»åŠ activeç±»åˆ°å½“å‰æŒ‰é’®
            if (event && event.target) {
                event.target.classList.add('active');
            }
            
            currentCameraMode = mode;
            
            switch(mode) {
                case 'overview':
                    focusedPlanet = null;
                    camera.position.set(0, 120, 150);
                    camera.lookAt(0, 0, 0);
                    break;
                case 'side':
                    focusedPlanet = null;
                    camera.position.set(200, 0, 0);
                    camera.lookAt(0, 0, 0);
                    break;
                case 'orrery':
                    focusedPlanet = null;
                    camera.position.set(0, 300, 0);
                    camera.lookAt(0, 0, 0);
                    break;
                case 'follow':
                    if (!focusedPlanet) focusedPlanet = planets[2]; // é»˜è®¤è·Ÿéšåœ°çƒ
                    break;
            }
        }

        // è®¾ç½®æ—¶é—´æ–¹å‘
        function setTimeDirection(direction) {
            timeDirection = direction;
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.getElementById('forwardBtn').classList.toggle('active', direction === 1);
            document.getElementById('reverseBtn').classList.toggle('active', direction === -1);
        }

        // è®¾ç½®æ¯”ä¾‹æ¨¡å¼
        function setScaleMode(mode) {
            // ç§»é™¤æ‰€æœ‰æ¯”ä¾‹æŒ‰é’®çš„activeç±»
            ['scaleMixedBtn', 'scaleDistanceBtn', 'scaleSizeBtn', 'scaleRealisticBtn'].forEach(id => {
                document.getElementById(id).classList.remove('active');
            });
            
            // æ·»åŠ activeç±»åˆ°å½“å‰æŒ‰é’®
            document.getElementById(`scale${mode.charAt(0).toUpperCase() + mode.slice(1)}Btn`).classList.add('active');
            
            scaleMode = mode;
            const info = document.getElementById('scaleInfo');
            
            planets.forEach((planet, index) => {
                const data = planet.userData;
                let newRadius, newDistance;
                
                switch(mode) {
                    case 'mixed':
                        newRadius = data.originalRadius * 1.5;
                        newDistance = data.originalDistance;
                        info.innerHTML = 'å½“å‰æ¨¡å¼ï¼šå¹³è¡¡æ¨¡å¼<br>é€‚åˆæ•™å­¦å’Œè§‚å¯Ÿçš„æœ€ä½³å¹³è¡¡';
                        break;
                        
                    case 'distance':
                        newRadius = data.originalRadius * 2.5;
                        newDistance = data.originalDistance;
                        info.innerHTML = 'å½“å‰æ¨¡å¼ï¼šè·ç¦»æ¯”ä¾‹æ­£ç¡®<br>è¡Œæ˜Ÿå¤§å°è¢«æ”¾å¤§ä»¥ä¾¿è§‚å¯Ÿ';
                        break;
                        
                    case 'size':
                        newRadius = data.originalRadius;
                        newDistance = data.originalDistance * 0.3;
                        info.innerHTML = 'å½“å‰æ¨¡å¼ï¼šå¤§å°æ¯”ä¾‹æ­£ç¡®<br>è½¨é“è·ç¦»è¢«å‹ç¼©ä»¥ä¾¿è§‚å¯Ÿ';
                        break;
                        
                    case 'realistic':
                        newRadius = data.originalRadius * 0.05;
                        newDistance = data.originalDistance * 3;
                        info.innerHTML = 'å½“å‰æ¨¡å¼ï¼šçœŸå®æ¯”ä¾‹<br>ä½“éªŒå®‡å®™çš„çœŸå®å°ºåº¦ï¼ˆè¡Œæ˜Ÿæå°ï¼‰';
                        break;
                }
                
                // æ›´æ–°è¡Œæ˜Ÿå‡ ä½•ä½“å’Œæ•°æ®
                planet.geometry.dispose();
                planet.geometry = new THREE.SphereGeometry(newRadius, 64, 64);
                planet.userData.radius = newRadius;
                planet.userData.distance = newDistance;
                
                // æ›´æ–°è½¨é“
                const orbit = orbits[index];
                if (orbit) {
                    orbit.geometry.dispose();
                    orbit.geometry = new THREE.RingGeometry(newDistance - 0.1, newDistance + 0.1, 256);
                }
                
                // é‡æ–°å®šä½è¡Œæ˜Ÿ
                const planetAngle = planet.userData.angle;
                const newPlanetX = Math.cos(planetAngle) * newDistance;
                const newPlanetZ = Math.sin(planetAngle) * newDistance;
                planet.position.set(newPlanetX, 0, newPlanetZ);
            });
        }

        // åˆ‡æ¢åŠŸèƒ½
        function toggleOrbits() {
            const show = document.getElementById('showOrbits').checked;
            orbits.forEach(orbit => {
                orbit.visible = show;
            });
        }

        function toggleAsteroids() {
            const show = document.getElementById('showAsteroids').checked;
            asteroids.forEach(asteroid => {
                asteroid.visible = show;
            });
        }

        function toggleComets() {
            const show = document.getElementById('showComets').checked;
            comets.forEach(comet => {
                comet.visible = show;
            });
        }

        function toggleTrails() {
            showTrails = document.getElementById('showTrails').checked;
            if (!showTrails) {
                // æ¸…é™¤ç°æœ‰è½¨è¿¹
                scene.children = scene.children.filter(child => !child.userData.isTrail);
            }
        }

        function toggleStats() {
            const panel = document.getElementById('statsPanel');
            panel.classList.toggle('visible');
        }

        function toggleEducation() {
            const panel = document.getElementById('educationPanel');
            panel.classList.toggle('visible');
        }

        function toggleHelp() {
            const panel = document.getElementById('helpPanel');
            panel.classList.toggle('visible');
        }

        function resetCamera() {
            setCamera('overview');
        }

        function pauseResume() {
            isPaused = !isPaused;
            const btn = event.target;
            btn.textContent = isPaused ? 'ç»§ç»­' : 'æš‚åœ';
            btn.classList.toggle('success', isPaused);
        }

        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                document.exitFullscreen();
            }
        }

        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        function updateStats() {
            const statsContent = document.getElementById('statsContent');
            
            statsContent.innerHTML = `
                <div style="margin-bottom: 10px;">å¸§ç‡: ${fps} FPS</div>
                <div style="margin-bottom: 10px;">å¤©ä½“æ•°é‡: ${planets.length + asteroids.length + comets.length + 1}</div>
                <div style="margin-bottom: 10px;">è¡Œæ˜Ÿ: ${planets.length}ä¸ª</div>
                <div style="margin-bottom: 10px;">å°è¡Œæ˜Ÿ: ${asteroids.length}ä¸ª</div>
                <div style="margin-bottom: 10px;">å½—æ˜Ÿ: ${comets.length}ä¸ª</div>
                <div style="margin-bottom: 10px;">ç›¸æœºæ¨¡å¼: ${currentCameraMode}</div>
                <div style="margin-bottom: 10px;">æ¯”ä¾‹æ¨¡å¼: ${scaleMode}</div>
                <div style="margin-bottom: 10px;">é€Ÿåº¦å€æ•°: ${speedMultiplier}x</div>
                <div style="margin-bottom: 10px;">æ—¶é—´æ–¹å‘: ${timeDirection > 0 ? 'æ­£å‘' : 'å€’æµ'}</div>
                <div>è·Ÿéšç›®æ ‡: ${focusedPlanet ? focusedPlanet.userData.name : 'æ— '}</div>
            `;
        }

        // æ›´æ–°è½¨è¿¹
        function updateTrails() {
            if (!showTrails) return;
            
            planets.forEach(planet => {
                const key = planet.userData.key;
                const points = trailPoints[key];
                
                // æ¯10å¸§è®°å½•ä¸€æ¬¡ä½ç½®
                if (frameCount % 10 === 0) {
                    points.push(planet.position.clone());
                    
                    // é™åˆ¶è½¨è¿¹ç‚¹æ•°é‡
                    if (points.length > 300) {
                        points.shift();
                    }
                }
                
                // åˆ›å»ºæˆ–æ›´æ–°è½¨è¿¹çº¿
                const existingTrail = scene.getObjectByName(`trail_${key}`);
                if (existingTrail) {
                    scene.remove(existingTrail);
                }
                
                if (points.length > 2) {
                    const geometry = new THREE.BufferGeometry().setFromPoints(points);
                    const material = new THREE.LineBasicMaterial({
                        color: planet.material.color,
                        transparent: true,
                        opacity: 0.6
                    });
                    
                    const trail = new THREE.Line(geometry, material);
                    trail.name = `trail_${key}`;
                    trail.userData = { isTrail: true };
                    scene.add(trail);
                }
            });
        }

        // æ›´æ–°FPSæ˜¾ç¤º
        function updateFPS() {
            const currentTime = performance.now();
            if (lastTime === 0) {
                lastTime = currentTime;
                return;
            }
            
            const deltaTime = currentTime - lastTime;
            if (deltaTime >= 1000) { // æ¯ç§’æ›´æ–°ä¸€æ¬¡FPS
                fps = Math.min(240, Math.round(frameCount * 1000 / deltaTime));
                document.getElementById('fpsDisplay').textContent = `${fps} FPS`;
                frameCount = 0;
                lastTime = currentTime;
            }
            frameCount++;
        }

        // ä¸»åŠ¨ç”»å¾ªç¯
        function animate() {
            animationId = requestAnimationFrame(animate);
            
            updateFPS();

            if (isPaused) {
                renderer.render(scene, camera);
                return;
            }

            // å¤ªé˜³è‡ªè½¬
            sun.rotation.y += 0.003 * speedMultiplier * timeDirection;

            // æ›´æ–°è¡Œæ˜Ÿä½ç½®ï¼ˆä¿®æ­£ç‰ˆï¼‰
            updatePlanetPositions();

            // å°è¡Œæ˜Ÿå¸¦è¿åŠ¨
            asteroids.forEach(asteroid => {
                const asteroidData = asteroid.userData;
                asteroidData.angle += asteroidData.speed * speedMultiplier * timeDirection;
                const asteroidX = Math.cos(asteroidData.angle) * asteroidData.distance;
                const asteroidZ = Math.sin(asteroidData.angle) * asteroidData.distance;
                asteroid.position.set(asteroidX, asteroid.position.y, asteroidZ);
                asteroid.rotation.x += asteroidData.rotationSpeed * speedMultiplier * timeDirection;
                asteroid.rotation.y += asteroidData.rotationSpeed * speedMultiplier * timeDirection;
            });

            // å½—æ˜Ÿæ¤­åœ†è½¨é“è¿åŠ¨
            comets.forEach(comet => {
                const cometData = comet.userData;
                cometData.angle += cometData.speed * speedMultiplier * timeDirection;
                
                const a = (cometData.aphelion + cometData.perihelion) / 2;
                const e = (cometData.aphelion - cometData.perihelion) / (cometData.aphelion + cometData.perihelion);
                const r = a * (1 - e * e) / (1 + e * Math.cos(cometData.angle));
                
                const cometX = Math.cos(cometData.angle) * r;
                const cometZ = Math.sin(cometData.angle) * r;
                comet.position.set(cometX, 0, cometZ);
                
                // å½—å°¾æ–¹å‘
                const sunDirection = new THREE.Vector3(0, 0, 0).sub(comet.position).normalize();
                if (comet.children[0]) {
                    const tailTarget = comet.position.clone().add(sunDirection.multiplyScalar(10));
                    comet.children[0].lookAt(tailTarget);
                }
            });

            // ä¼˜åŒ–çš„è·Ÿéšç›¸æœº
            updateFollowCamera();

            // æ›´æ–°è½¨è¿¹
            updateTrails();

            // æ˜Ÿç©ºæ—‹è½¬
            if (starField) {
                starField.rotation.y += 0.0001 * speedMultiplier * timeDirection;
            }

            // æ›´æ–°ç»Ÿè®¡é¢æ¿
            if (document.getElementById('statsPanel').classList.contains('visible')) {
                updateStats();
            }

            renderer.render(scene, camera);
        }

        // å¯åŠ¨åº”ç”¨
        init();
    </script>
</body>
</html>
