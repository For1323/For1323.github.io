<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>交互式3D太阳系</title>
  <style>
    body { margin: 0; overflow: hidden; background: black; }
    canvas { display: block; }

    /* 信息面板 */
    #infoBox {
      position: absolute;
      top: 80px;
      left: 20px;
      background: rgba(0,0,0,0.65);
      color: white;
      padding: 12px;
      border-radius: 12px;
      font-family: "Segoe UI", sans-serif;
      max-width: 300px;
      display: none;
      box-shadow: 0 4px 20px rgba(0,0,0,0.5);
      line-height: 1.5;
    }

    /* 控制面板 */
    #uiPanel {
      position: absolute;
      top: 20px;
      right: 20px;
      background: rgba(30,30,30,0.8);
      padding: 12px 18px;
      border-radius: 12px;
      font-family: "Segoe UI", sans-serif;
      color: #fff;
      box-shadow: 0 4px 25px rgba(0,0,0,0.6);
    }
    #uiPanel h3 {
      margin: 0 0 10px 0;
      font-size: 16px;
      color: #ffcc66;
    }
    #uiPanel button {
      display: block;
      width: 120px;
      margin: 6px 0;
      padding: 8px 12px;
      border: none;
      border-radius: 8px;
      background: #444;
      color: white;
      font-size: 14px;
      cursor: pointer;
      transition: 0.2s;
    }
    #uiPanel button:hover {
      background: #666;
    }
    #uiPanel button.active {
      background: #ff9933;
    }
  </style>
</head>
<body>
<div id="infoBox"></div>
<div id="uiPanel">
  <h3>视图模式</h3>
  <button id="solarBtn" class="active">太阳系全览</button>
  <button id="earthBtn">地月系统</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/examples/js/controls/OrbitControls.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/examples/js/libs/tween.min.js"></script>

<script>
  // ---------------- 场景与相机 ----------------
  const scene = new THREE.Scene();
  const camera = new THREE.PerspectiveCamera(45, window.innerWidth/window.innerHeight, 0.1, 5000);
  camera.position.set(0, 250, 600);

  const renderer = new THREE.WebGLRenderer({antialias: true});
  renderer.setSize(window.innerWidth, window.innerHeight);
  document.body.appendChild(renderer.domElement);

  const controls = new THREE.OrbitControls(camera, renderer.domElement);
  controls.enableDamping = true;
  controls.dampingFactor = 0.05;

  // ---------------- 背景星空 ----------------
  const starTexture = new THREE.TextureLoader().load("https://cdn.jsdelivr.net/gh/mrdoob/three.js@r148/examples/textures/cube/space/px.jpg");
  scene.background = starTexture;

  // ---------------- 光源 ----------------
  const light = new THREE.PointLight(0xffffff, 2, 0);
  scene.add(light);

  // ---------------- 太阳 ----------------
  const sunTexture = new THREE.TextureLoader().load("https://cdn.jsdelivr.net/gh/mrdoob/three.js@r148/examples/textures/planets/sun.jpg");
  const sun = new THREE.Mesh(
    new THREE.SphereGeometry(20, 64, 64),
    new THREE.MeshBasicMaterial({ map: sunTexture })
  );
  scene.add(sun);

  // ---------------- 行星数据 ----------------
  const planetsData = [
    { name: "水星", size: 2, distance: 30, speed: 0.04, texture: "https://cdn.jsdelivr.net/gh/mrdoob/three.js@r148/examples/textures/planets/mercury.jpg" },
    { name: "金星", size: 3.5, distance: 45, speed: 0.015, texture: "https://cdn.jsdelivr.net/gh/mrdoob/three.js@r148/examples/textures/planets/venus.jpg" },
    { name: "地球", size: 4, distance: 65, speed: 0.01, texture: "https://cdn.jsdelivr.net/gh/mrdoob/three.js@r148/examples/textures/planets/earth_atmos_2048.jpg" },
    { name: "火星", size: 3, distance: 85, speed: 0.008, texture: "https://cdn.jsdelivr.net/gh/mrdoob/three.js@r148/examples/textures/planets/mars_1k_color.jpg" },
    { name: "木星", size: 9, distance: 120, speed: 0.002, texture: "https://cdn.jsdelivr.net/gh/mrdoob/three.js@r148/examples/textures/planets/jupiter.jpg" },
    { name: "土星", size: 8, distance: 150, speed: 0.0015, texture: "https://cdn.jsdelivr.net/gh/mrdoob/three.js@r148/examples/textures/planets/saturn.jpg" },
    { name: "天王星", size: 7, distance: 180, speed: 0.001, texture: "https://cdn.jsdelivr.net/gh/mrdoob/three.js@r148/examples/textures/planets/uranus.jpg" },
    { name: "海王星", size: 7, distance: 210, speed: 0.0008, texture: "https://cdn.jsdelivr.net/gh/mrdoob/three.js@r148/examples/textures/planets/neptune.jpg" }
  ];

  const planets = [];
  const textureLoader = new THREE.TextureLoader();

  planetsData.forEach(data => {
    const planet = new THREE.Mesh(
      new THREE.SphereGeometry(data.size, 32, 32),
      new THREE.MeshStandardMaterial({ map: textureLoader.load(data.texture) })
    );
    planet.position.x = data.distance;
    planet.userData = { ...data, angle: Math.random() * Math.PI * 2 };
    scene.add(planet);
    planets.push(planet);

    // 土星光环
    if(data.name === "土星"){
      const ringGeo = new THREE.RingGeometry(data.size*1.3, data.size*2.2, 64);
      const ringMat = new THREE.MeshBasicMaterial({
        map: textureLoader.load("https://cdn.jsdelivr.net/gh/mrdoob/three.js@r148/examples/textures/planets/saturnringcolor.jpg"),
        side: THREE.DoubleSide,
        transparent: true
      });
      const ring = new THREE.Mesh(ringGeo, ringMat);
      ring.rotation.x = Math.PI/2.3;
      planet.add(ring);
    }

    // 地球-月球系统
    if(data.name === "地球"){
      const moon = new THREE.Mesh(
        new THREE.SphereGeometry(1.2, 32, 32),
        new THREE.MeshStandardMaterial({ map: textureLoader.load("https://cdn.jsdelivr.net/gh/mrdoob/three.js@r148/examples/textures/planets/moon_1024.jpg") })
      );
      moon.position.x = 7;
      moon.userData = { name: "月球", distance: 7, speed: 0.03, angle: 0 };
      planet.add(moon);
      planet.userData.moon = moon;
    }
  });

  // ---------------- 点击显示信息 ----------------
  const raycaster = new THREE.Raycaster();
  const mouse = new THREE.Vector2();
  const infoBox = document.getElementById("infoBox");

  function onClick(event){
    mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
    mouse.y = - (event.clientY / window.innerHeight) * 2 + 1;

    raycaster.setFromCamera(mouse, camera);
    const intersects = raycaster.intersectObjects(planets, false);

    if(intersects.length > 0){
      const planet = intersects[0].object;
      const data = planet.userData;
      infoBox.innerHTML = `<strong>${data.name}</strong><br>
                          平均距离: ${data.distance} AU<br>
                          公转速度: ${data.speed.toFixed(4)} rad/frame`;
      infoBox.style.display = "block";
    }
  }
  window.addEventListener("click", onClick);

  // ---------------- 相机切换 ----------------
  let mode = "solar";
  document.getElementById("solarBtn").onclick = () => { mode="solar"; updateUI("solarBtn"); flyTo({x:0,y:250,z:600}, {x:0,y:0,z:0}); };
  document.getElementById("earthBtn").onclick = () => { mode="earth"; updateUI("earthBtn"); focusEarth(); };

  function updateUI(activeId){
    document.querySelectorAll("#uiPanel button").forEach(btn => btn.classList.remove("active"));
    document.getElementById(activeId).classList.add("active");
  }

  function flyTo(pos, target){
    new TWEEN.Tween(camera.position).to(pos, 2000).easing(TWEEN.Easing.Quadratic.InOut).start();
    new TWEEN.Tween(controls.target).to(target, 2000).easing(TWEEN.Easing.Quadratic.InOut).start();
  }

  function focusEarth(){
    const earth = planets.find(p => p.userData.name==="地球");
    if(earth){
      flyTo({x:earth.position.x+25,y:15,z:earth.position.z+25}, {x:earth.position.x,y:earth.position.y,z:earth.position.z});
    }
  }

  // ---------------- 动画 ----------------
  function animate(){
    requestAnimationFrame(animate);

    sun.rotation.y += 0.002;

    planets.forEach(p => {
      p.userData.angle += p.userData.speed;
      p.position.x = Math.cos(p.userData.angle) * p.userData.distance;
      p.position.z = Math.sin(p.userData.angle) * p.userData.distance;
      p.rotation.y += 0.01;

      if(p.userData.moon){
        const m = p.userData.moon;
        m.userData.angle += m.userData.speed;
        m.position.x = Math.cos(m.userData.angle) * m.userData.distance;
        m.position.z = Math.sin(m.userData.angle) * m.userData.distance;
      }
    });

    TWEEN.update();
    controls.update();
    renderer.render(scene, camera);
  }
  animate();

  // ---------------- 自适应窗口 ----------------
  window.addEventListener("resize", () => {
    camera.aspect = window.innerWidth/window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
  });
</script>
</body>
</html>
