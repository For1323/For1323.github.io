<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Solar System 3D Model</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: radial-gradient(ellipse at center, #1a1a2e 0%, #16213e 50%, #0f0f23 100%);
            overflow: hidden;
            color: white;
        }

        #container {
            position: relative;
            width: 100vw;
            height: 100vh;
        }

        #controls {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 100;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            min-width: 300px;
        }

        .control-group {
            margin-bottom: 20px;
        }

        .control-group:last-child {
            margin-bottom: 0;
        }

        .control-label {
            display: block;
            margin-bottom: 10px;
            font-size: 14px;
            color: #a0a0ff;
            font-weight: bold;
        }

        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn {
            background: linear-gradient(45deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
            transition: all 0.3s ease;
            text-transform: uppercase;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn.active {
            background: linear-gradient(45deg, #f093fb 0%, #f5576c 100%);
            box-shadow: 0 3px 10px rgba(245, 87, 108, 0.4);
        }

        .speed-control {
            width: 100%;
        }

        .speed-slider {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: linear-gradient(90deg, #667eea, #764ba2);
            outline: none;
            opacity: 0.8;
            transition: opacity 0.2s;
        }

        .speed-slider:hover {
            opacity: 1;
        }

        .speed-value {
            text-align: center;
            margin-top: 8px;
            color: #ffffff;
            font-weight: bold;
        }

        #planetInfo {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 100;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(15px);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            width: 350px;
            transform: translateX(400px);
            transition: transform 0.4s ease;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        #planetInfo.visible {
            transform: translateX(0);
        }

        .planet-name {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #667eea, #f093fb);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .planet-english {
            font-size: 14px;
            color: #a0a0ff;
            margin-bottom: 20px;
            font-style: italic;
        }

        .planet-data {
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .planet-data:last-child {
            border-bottom: none;
        }

        .data-label {
            color: #a0a0ff;
            font-weight: bold;
            font-size: 14px;
        }

        .data-value {
            color: white;
            font-weight: normal;
            text-align: right;
            font-size: 14px;
        }

        .close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.3s ease;
        }

        .close-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        #title {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
            text-align: center;
            color: white;
        }

        .main-title {
            font-size: 28px;
            font-weight: bold;
            background: linear-gradient(45deg, #667eea, #f093fb);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 8px;
        }

        .subtitle {
            font-size: 14px;
            color: #a0a0ff;
            opacity: 0.8;
        }

        .scale-info {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: #a0a0ff;
            font-size: 12px;
            max-width: 250px;
        }

        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1000;
            text-align: center;
            color: white;
            font-size: 18px;
        }

        .spinner {
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 3px solid #667eea;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div id="container">
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>正在加载太阳系...</p>
        </div>

        <div id="controls">
            <div class="control-group">
                <label class="control-label">视角切换</label>
                <div class="button-group">
                    <button class="btn active" onclick="setCamera('overview')">全景俯瞰</button>
                    <button class="btn" onclick="setCamera('side')">侧视角</button>
                    <button class="btn" onclick="setCamera('orrery')">太阳系仪</button>
                </div>
            </div>

            <div class="control-group">
                <label class="control-label">公转速度</label>
                <div class="speed-control">
                    <input type="range" class="speed-slider" min="0.1" max="10" step="0.1" value="1" id="speedSlider">
                    <div class="speed-value" id="speedValue">1.0x</div>
                </div>
            </div>

            <div class="control-group">
                <label class="control-label">显示比例</label>
                <div class="button-group">
                    <button class="btn active" onclick="toggleScale()" id="scaleBtn">距离比例</button>
                </div>
            </div>
        </div>

        <div id="planetInfo">
            <button class="close-btn" onclick="closePlanetInfo()">×</button>
            <div class="planet-name" id="planetName"></div>
            <div class="planet-english" id="planetEnglish"></div>
            <div id="planetData"></div>
        </div>

        <div id="title">
            <h1 class="main-title">互动太阳系 3D 模型</h1>
            <p class="subtitle">点击行星查看详细信息 • 使用鼠标拖拽和滚轮操作视角</p>
        </div>

        <div class="scale-info" id="scaleInfo">
            当前模式：距离比例正确<br>
            行星大小被放大以便观察
        </div>
    </div>

    <script>
        // 全局变量
        let scene, camera, renderer, controls;
        let planets = [];
        let orbits = [];
        let sun;
        let speedMultiplier = 1;
        let currentCameraMode = 'overview';
        let scaleMode = 'distance'; // 'distance' or 'size'
        let animationId;
        let starField;
        let focusedPlanet = null;
        
        // 行星数据
        const planetData = {
            mercury: {
                name: '水星', english: 'Mercury',
                radius: 0.38, distance: 10, speed: 0.02, color: 0x8c7853,
                diameter: '4,879 km', avgDistance: '5,790万 km', 
                orbitalPeriod: '88天', rotationPeriod: '59天', type: '岩石行星'
            },
            venus: {
                name: '金星', english: 'Venus',
                radius: 0.95, distance: 15, speed: 0.015, color: 0xffc649,
                diameter: '12,104 km', avgDistance: '1.08亿 km',
                orbitalPeriod: '225天', rotationPeriod: '243天', type: '岩石行星'
            },
            earth: {
                name: '地球', english: 'Earth',
                radius: 1, distance: 20, speed: 0.01, color: 0x6b93d6,
                diameter: '12,756 km', avgDistance: '1.5亿 km',
                orbitalPeriod: '365天', rotationPeriod: '24小时', type: '岩石行星'
            },
            mars: {
                name: '火星', english: 'Mars',
                radius: 0.53, distance: 25, speed: 0.008, color: 0xc1440e,
                diameter: '6,792 km', avgDistance: '2.28亿 km',
                orbitalPeriod: '687天', rotationPeriod: '24.6小时', type: '岩石行星'
            },
            jupiter: {
                name: '木星', english: 'Jupiter',
                radius: 3, distance: 35, speed: 0.004, color: 0xd8ca9d,
                diameter: '142,984 km', avgDistance: '7.79亿 km',
                orbitalPeriod: '12年', rotationPeriod: '9.9小时', type: '气态巨星'
            },
            saturn: {
                name: '土星', english: 'Saturn',
                radius: 2.5, distance: 45, speed: 0.003, color: 0xfad5a5,
                diameter: '120,536 km', avgDistance: '14.3亿 km',
                orbitalPeriod: '29年', rotationPeriod: '10.7小时', type: '气态巨星'
            },
            uranus: {
                name: '天王星', english: 'Uranus',
                radius: 1.5, distance: 55, speed: 0.002, color: 0x4fd0e7,
                diameter: '51,118 km', avgDistance: '28.7亿 km',
                orbitalPeriod: '84年', rotationPeriod: '17.2小时', type: '冰巨星'
            },
            neptune: {
                name: '海王星', english: 'Neptune',
                radius: 1.4, distance: 65, speed: 0.0015, color: 0x4b70dd,
                diameter: '49,528 km', avgDistance: '45.0亿 km',
                orbitalPeriod: '165年', rotationPeriod: '16.1小时', type: '冰巨星'
            }
        };

        // 初始化场景
        function init() {
            // 创建场景
            scene = new THREE.Scene();

            // 创建相机
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 2000);
            camera.position.set(0, 100, 100);

            // 创建渲染器
            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            document.getElementById('container').appendChild(renderer.domElement);

            // 创建星空背景
            createStarField();

            // 创建太阳
            createSun();

            // 创建行星和轨道
            createPlanets();

            // 创建光源
            const ambientLight = new THREE.AmbientLight(0x404040, 0.4);
            scene.add(ambientLight);

            const sunLight = new THREE.PointLight(0xffffff, 2, 500);
            sunLight.position.set(0, 0, 0);
            sunLight.castShadow = true;
            sunLight.shadow.mapSize.width = 2048;
            sunLight.shadow.mapSize.width = 2048;
            scene.add(sunLight);

            // 设置控制器
            setupControls();

            // 设置事件监听
            setupEventListeners();

            // 隐藏加载界面
            document.getElementById('loading').style.display = 'none';

            // 开始动画
            animate();
        }

        // 创建星空背景
        function createStarField() {
            const geometry = new THREE.SphereGeometry(800, 32, 32);
            const material = new THREE.MeshBasicMaterial({
                color: 0x000011,
                side: THREE.BackSide
            });
            starField = new THREE.Mesh(geometry, material);
            
            // 添加星点
            const starGeometry = new THREE.BufferGeometry();
            const starMaterial = new THREE.PointsMaterial({
                color: 0xffffff,
                size: 2,
                sizeAttenuation: false
            });

            const starVertices = [];
            for (let i = 0; i < 10000; i++) {
                const theta = Math.random() * Math.PI * 2;
                const phi = Math.acos(Math.random() * 2 - 1);
                const r = 700 + Math.random() * 100;
                
                starVertices.push(
                    r * Math.sin(phi) * Math.cos(theta),
                    r * Math.sin(phi) * Math.sin(theta),
                    r * Math.cos(phi)
                );
            }

            starGeometry.setAttribute('position', new THREE.Float32BufferAttribute(starVertices, 3));
            const stars = new THREE.Points(starGeometry, starMaterial);
            
            scene.add(starField);
            scene.add(stars);
        }

        // 创建太阳
        function createSun() {
            const sunGeometry = new THREE.SphereGeometry(5, 32, 32);
            const sunMaterial = new THREE.MeshBasicMaterial({
                color: 0xffff00,
                emissive: 0xff6600,
                emissiveIntensity: 0.3
            });
            
            sun = new THREE.Mesh(sunGeometry, sunMaterial);
            sun.castShadow = false;
            sun.userData = { 
                name: '太阳', 
                english: 'Sun',
                diameter: '1,392,700 km',
                avgDistance: '0 km',
                orbitalPeriod: '不适用',
                rotationPeriod: '25天',
                type: '恒星'
            };
            scene.add(sun);
        }

        // 创建行星
        function createPlanets() {
            const planetKeys = Object.keys(planetData);
            
            planetKeys.forEach((key, index) => {
                const data = planetData[key];
                
                // 创建轨道
                const orbitGeometry = new THREE.RingGeometry(data.distance - 0.1, data.distance + 0.1, 64);
                const orbitMaterial = new THREE.MeshBasicMaterial({
                    color: 0x444444,
                    side: THREE.DoubleSide,
                    transparent: true,
                    opacity: 0.3
                });
                const orbit = new THREE.Mesh(orbitGeometry, orbitMaterial);
                orbit.rotation.x = -Math.PI / 2;
                scene.add(orbit);
                orbits.push(orbit);

                // 创建行星
                const planetGeometry = new THREE.SphereGeometry(data.radius, 32, 32);
                const planetMaterial = new THREE.MeshLambertMaterial({ color: data.color });
                const planet = new THREE.Mesh(planetGeometry, planetMaterial);
                
                planet.position.x = data.distance;
                planet.castShadow = true;
                planet.receiveShadow = true;
                
                planet.userData = {
                    ...data,
                    key: key,
                    angle: Math.random() * Math.PI * 2,
                    originalRadius: data.radius,
                    originalDistance: data.distance
                };
                
                scene.add(planet);
                planets.push(planet);

                // 为土星添加光环
                if (key === 'saturn') {
                    const ringGeometry = new THREE.RingGeometry(data.radius * 1.5, data.radius * 2.5, 32);
                    const ringMaterial = new THREE.MeshBasicMaterial({
                        color: 0xccccaa,
                        side: THREE.DoubleSide,
                        transparent: true,
                        opacity: 0.6
                    });
                    const ring = new THREE.Mesh(ringGeometry, ringMaterial);
                    ring.rotation.x = -Math.PI / 2;
                    planet.add(ring);
                }
            });
        }

        // 设置控制器
        function setupControls() {
            // 简单的鼠标控制
            let mouseDown = false;
            let mouseX = 0;
            let mouseY = 0;

            renderer.domElement.addEventListener('mousedown', (event) => {
                mouseDown = true;
                mouseX = event.clientX;
                mouseY = event.clientY;
            });

            renderer.domElement.addEventListener('mouseup', () => {
                mouseDown = false;
            });

            renderer.domElement.addEventListener('mousemove', (event) => {
                if (!mouseDown) return;

                const deltaX = event.clientX - mouseX;
                const deltaY = event.clientY - mouseY;

                // 旋转相机
                const spherical = new THREE.Spherical();
                spherical.setFromVector3(camera.position);
                
                spherical.theta -= deltaX * 0.01;
                spherical.phi += deltaY * 0.01;
                spherical.phi = Math.max(0.1, Math.min(Math.PI - 0.1, spherical.phi));

                camera.position.setFromSpherical(spherical);
                camera.lookAt(0, 0, 0);

                mouseX = event.clientX;
                mouseY = event.clientY;
            });

            // 鼠标滚轮缩放
            renderer.domElement.addEventListener('wheel', (event) => {
                const distance = camera.position.length();
                const newDistance = distance + event.deltaY * 0.1;
                
                if (newDistance > 10 && newDistance < 500) {
                    camera.position.normalize();
                    camera.position.multiplyScalar(newDistance);
                }
            });
        }

        // 设置事件监听
        function setupEventListeners() {
            // 速度滑块
            const speedSlider = document.getElementById('speedSlider');
            speedSlider.addEventListener('input', (e) => {
                speedMultiplier = parseFloat(e.target.value);
                document.getElementById('speedValue').textContent = speedMultiplier.toFixed(1) + 'x';
            });

            // 窗口大小调整
            window.addEventListener('resize', () => {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            });

            // 点击行星
            renderer.domElement.addEventListener('click', onPlanetClick);
        }

        // 行星点击事件
        function onPlanetClick(event) {
            const mouse = new THREE.Vector2();
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

            const raycaster = new THREE.Raycaster();
            raycaster.setFromCamera(mouse, camera);

            const intersects = raycaster.intersectObjects([sun, ...planets]);
            
            if (intersects.length > 0) {
                const clickedObject = intersects[0].object;
                showPlanetInfo(clickedObject.userData);
            }
        }

        // 显示行星信息
        function showPlanetInfo(data) {
            document.getElementById('planetName').textContent = data.name;
            document.getElementById('planetEnglish').textContent = data.english;
            
            const planetDataDiv = document.getElementById('planetData');
            planetDataDiv.innerHTML = `
                <div class="planet-data">
                    <span class="data-label">直径:</span>
                    <span class="data-value">${data.diameter}</span>
                </div>
                <div class="planet-data">
                    <span class="data-label">与太阳距离:</span>
                    <span class="data-value">${data.avgDistance}</span>
                </div>
                <div class="planet-data">
                    <span class="data-label">公转周期:</span>
                    <span class="data-value">${data.orbitalPeriod}</span>
                </div>
                <div class="planet-data">
                    <span class="data-label">自转周期:</span>
                    <span class="data-value">${data.rotationPeriod}</span>
                </div>
                <div class="planet-data">
                    <span class="data-label">天体类型:</span>
                    <span class="data-value">${data.type}</span>
                </div>
            `;
            
            document.getElementById('planetInfo').classList.add('visible');
        }

        // 关闭行星信息
        function closePlanetInfo() {
            document.getElementById('planetInfo').classList.remove('visible');
        }

        // 设置相机视角
        function setCamera(mode) {
            // 移除所有按钮的active类
            document.querySelectorAll('#controls .btn').forEach(btn => {
                if (btn.textContent.includes('俯瞰') || btn.textContent.includes('侧视') || btn.textContent.includes('系仪')) {
                    btn.classList.remove('active');
                }
            });
            
            // 添加active类到当前按钮
            event.target.classList.add('active');
            
            currentCameraMode = mode;
            
            switch(mode) {
                case 'overview':
                    camera.position.set(0, 150, 150);
                    break;
                case 'side':
                    camera.position.set(200, 0, 0);
                    break;
                case 'orrery':
                    camera.position.set(0, 200, 0);
                    break;
            }
            camera.lookAt(0, 0, 0);
        }

        // 切换比例模式
        function toggleScale() {
            const btn = document.getElementById('scaleBtn');
            const info = document.getElementById('scaleInfo');
            
            if (scaleMode === 'distance') {
                scaleMode = 'size';
                btn.textContent = '大小比例';
                info.innerHTML = '当前模式：大小比例正确<br>轨道距离被压缩以便观察';
                
                // 调整行星大小和距离
                planets.forEach((planet, index) => {
                    const data = planet.userData;
                    planet.geometry.dispose();
                    planet.geometry = new THREE.SphereGeometry(data.originalRadius * 2, 32, 32);
                    planet.userData.distance = data.originalDistance * 0.5;
                });
                
                // 调整轨道
                orbits.forEach((orbit, index) => {
                    const planet = planets[index];
                    const distance = planet.userData.distance;
                    orbit.geometry.dispose();
                    orbit.geometry = new THREE.RingGeometry(distance - 0.1, distance + 0.1, 64);
                });
                
            } else {
                scaleMode = 'distance';
                btn.textContent = '距离比例';
                info.innerHTML = '当前模式：距离比例正确<br>行星大小被放大以便观察';
                
                // 恢复原始设置
                planets.forEach((planet, index) => {
                    const data = planet.userData;
                    planet.geometry.dispose();
                    planet.geometry = new THREE.SphereGeometry(data.originalRadius, 32, 32);
                    planet.userData.distance = data.originalDistance;
                });
                
                // 恢复轨道
                orbits.forEach((orbit, index) => {
                    const planet = planets[index];
                    const distance = planet.userData.distance;
                    orbit.geometry.dispose();
                    orbit.geometry = new THREE.RingGeometry(distance - 0.1, distance + 0.1, 64);
                });
            }
        }

        // 动画循环
        function animate() {
            animationId = requestAnimationFrame(animate);

            // 旋转太阳
            sun.rotation.y += 0.005 * speedMultiplier;

            // 行星公转和自转
            planets.forEach(planet => {
                const data = planet.userData;
                
                // 公转
                data.angle += data.speed * speedMultiplier;
                planet.position.x = Math.cos(data.angle) * data.distance;
                planet.position.z = Math.sin(data.angle) * data.distance;
                
                // 自转
                planet.rotation.y += 0.01 * speedMultiplier;
            });

            // 星空缓慢旋转
            if (starField) {
                starField.rotation.y += 0.0001;
            }

            renderer.render(scene, camera);
        }

        // 启动应用
        init();
    </script>
</body>
</html>
